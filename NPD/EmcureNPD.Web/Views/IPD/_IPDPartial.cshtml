@using Microsoft.AspNetCore.Http
@using EmcureNPD.Web.Controllers
@using Microsoft.AspNetCore.Mvc.Localization
@using EmcureNPD.Utility.Utility
@using EmcureNPD.Utility.Enums
@inject Microsoft.Extensions.Localization.IStringLocalizer<EmcureNPD.Resource.Master> MasterLocalizer
@inject Microsoft.Extensions.Localization.IStringLocalizer<EmcureNPD.Resource.Shared> SharedLocalizer
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration

@model EmcureNPD.Business.Models.IPDEntity

@{
    string jsVersion = @Configuration.GetSection("StaticJS")["version"];
    string dateRange = DateTime.Now.ToString("yyyy-MM-dd");



}

<form id="fIPDForm_@Model.BusinessUnitId" class="needs-validation" asp-action="IPD">
    <div class="tab-content" id="tabList">
        <div>
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group required">
                        <input type="hidden" asp-for="BusinessUnitId" />
                        <input type="hidden" asp-for="PIDFID" />
                        <input type="hidden" asp-for="IPDID" />
                        <input type="hidden" asp-for="TotalParent" />
                        <input type="hidden" asp-for="RegionIds" />
                        <input type="hidden" asp-for="CountryIds" />
                        <input type="hidden" asp-for="SaveType" />
                        <input type="hidden" asp-for="SelectedCountryId" />
                        
                        @Html.LabelFor(model => model.ProjectName, "Project Name", new { @class = "control-label" })
                        @Html.EditorFor(model => model.ProjectName, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = @MasterLocalizer["Project Name"] } })
                        @Html.ValidationMessageFor(model => model.ProjectName, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.Innovators,"Innovator", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.EditorFor(model => model.Innovators, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = @MasterLocalizer["RFDInnovators"]} })
                        @Html.ValidationMessageFor(model => model.Innovators, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.PatentStatus, @MasterLocalizer["PatentStatus"], new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.DropDownListFor(model => model.PatentStatus,new List<SelectListItem> {new SelectListItem() {  Text = "Patented", Value = "Patented"  }, new SelectListItem() {Text = "Generic", Value = "Generic"}}, new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = @MasterLocalizer["PatentStatus"]})
                       
                        @Html.ValidationMessageFor(model => model.PatentStatus, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            @*---------------Start--Country---------------------*@

            <div class="card card-info card-outline-tabs m-0">
                <div class="card-header p-0 border-bottom-0">
                    @*@if (Model.MasterStrengthEntities.Count() > 0 || Model.MasterStrengthEntities != null)
                    {
                    <input type="hidden" id="PIDFProductStrengthId" value="@Model.MasterStrengthEntities[0].PidfproductStrengthId" />
                    }*@
                    <ul class="nav nav-tabs row m-0 text-center" id="navCountryTabs_IPD">
                    </ul>
                </div>
            </div>
            <div class="clearfix">&nbsp;</div>
            @*-----------------End- of-Country---------------------*@

            <div class="row">
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.MarketName, new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.EditorFor(model => model.MarketName, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = "Brand"} })
                        @Html.ValidationMessageFor(model => model.MarketName, "", new { @class = "text-danger" })
                    </div>
                </div>             
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.DataExclusivity, "Data Exclusivity", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.DropDownListFor(model => model.DataExclusivity,new List<SelectListItem> {new SelectListItem() { Text = "Yes", Value = "Yes" }, new SelectListItem() { Text = "No", Value = "No" }}, new { @autocomplete = "off", @class = "form-control customvalidateformcontrol"})
                       @* @Html.EditorFor(model => model.DataExclusivity, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control customvalidateformcontrol" } })*@
                        @Html.ValidationMessageFor(model => model.DataExclusivity, "", new { @class = "text-danger" })
                    </div>  
                </div>
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.MarketExclusivityDate, "Market Exclusivity Date", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @*@Html.EditorFor(model => model.MarketExclusivityDate, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked" } })*@
                        @Html.TextBoxFor(@modal=> modal.MarketExclusivityDate,"{0:yyyy-MM-dd}",new{@type="date",@class="form-control"})
                        @Html.ValidationMessageFor(model => model.MarketExclusivityDate, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.ExpectedFilingDate, "Expected Filing Date", new { @class = "control-label" }) <span class="text-danger">*</span>
                       @Html.TextBoxFor(@modal=> modal.ExpectedFilingDate,"{0:yyyy-MM-dd}",new{@type="date",@class="form-control"})
                        @Html.ValidationMessageFor(model => model.ExpectedFilingDate, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.ExpectedLaunchDate, "Expected Launch Date", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.TextBoxFor(@modal=> modal.ExpectedLaunchDate,"{0:yyyy-MM-dd}",new{@type="date",@class="form-control"})
                        @Html.ValidationMessageFor(model => model.ExpectedLaunchDate, "", new { @class = "text-danger" })
                    </div>
                </div>
               @* <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.FillingType, "Type of Filling", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.EditorFor(model => model.FillingType, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = @MasterLocalizer["Type of Filling"] } })
                        @Html.ValidationMessageFor(model => model.FillingType, "", new { @class = "text-danger" })
                    </div>
                </div>*@

                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.ApprovedGenetics, "Approved Generics", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.EditorFor(model => model.ApprovedGenetics, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = @MasterLocalizer["Approved Generics"] } })
                        @Html.ValidationMessageFor(model => model.ApprovedGenetics, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.LaunchedGenetics, "Launched Genetics", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.EditorFor(model => model.LaunchedGenetics, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = @MasterLocalizer["Launched Genetics"]} })
                        @Html.ValidationMessageFor(model => model.LaunchedGenetics, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <div class="row">
                @*<div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.RegionId, new { @class = "control-label" })
                        @Html.DropDownListFor(model => model.RegionId,new List<SelectListItem> { }, new { @class = "form-control regionCombo", @multiple = "multiple"  })

                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.CountryId, new { @class = "control-label" })
                        @Html.DropDownListFor(model => model.CountryId, new List<SelectListItem> { }, htmlAttributes: new { @class = "form-control countryCombo", @multiple = "multiple" })
                    </div>
                </div>*@
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.LegalStatus, "Litigation Possibility", new { @class = "control-label" }) <span class="text-danger">*</span>
                      @*  @Html.EditorFor(model => model.LegalStatus, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked customvalidateformcontrol", @placeholder = @MasterLocalizer["Legal Status"]} })*@
                        @Html.DropDownListFor(model => model.LegalStatus,new List<SelectListItem> {new SelectListItem() { Text = "Yes", Value = "Yes" }, new SelectListItem() { Text = "No", Value = "No" }}, new { @autocomplete = "off", @class = "form-control customvalidateformcontrol"})
                        @Html.ValidationMessageFor(model => model.LegalStatus, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.CostOfLitication, "Cost of Litigation (In Lacs)", new { @class = "control-label" }) <span class="text-danger">*</span>
                        @Html.EditorFor(model => model.CostOfLitication, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked", @placeholder = @MasterLocalizer["Cost of Litigation"]} })
                        @Html.ValidationMessageFor(model => model.CostOfLitication, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group required">
                        @Html.LabelFor(model => model.IsComment, "IPD Comments", new { @class = "control-label" })
                        <div onclick="checkRadioCheckOrNot()">
                            @Html.RadioButtonFor(model => model.IsComment, true, new { @class="IPDIsComment" }) @Html.LabelFor(model => model.IsComment, "Yes")
                            @Html.RadioButtonFor(model => model.IsComment, false) @Html.Label("No")
                            <br />
                            @Html.ValidationMessageFor(model => model.IsComment, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>
            </div>
            @if (Model.IsComment)
            {
                <div class="row" id="dvIPDComments">
                    <div class="col-md-12">
                        <div class="form-group required">
                            @Html.TextAreaFor(model => model.Comments, new { @class = "form-control IPDCommentText" })
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="row" id="dvIPDComments">
                    <div class="col-md-12">
                        <div class="form-group required">
                            @Html.TextAreaFor(model => model.Comments, new { @class = "form-control IPDCommentText",@readonly=true,@disabled=true })
                        </div>
                    </div>
                </div>
            }
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-primary">
                            <h3 class="card-title mb-0"><button type="button" class="btn btn-tool" data-card-widget="collapse">Patent Details for Formulation</button></h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body table-overflow" style="display: block;">
                            <table id="PIDFTable" class="table table-bordered table-striped table-hover " style="width:100%">
                                <thead>
                                    <tr>
                                      
                                        <th width="13%">@MasterLocalizer["Patent Number"] <span class="text-danger">*</span></th>
                                        <th width="20%">Type <span class="text-danger">*</span> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp</th>
                                        <th width="13%">@SharedLocalizer["Original Expiry Date"] <span class="text-danger">*</span></th>
                                        <th width="13%">@SharedLocalizer["Extension Expiry Date"] <span class="text-danger">*</span></th>
                                        <th width="20%">@SharedLocalizer["Comments (Patent Specific)"] <span class="text-danger">*</span></th>
                                       
                                        @*<th width="20%">Country </th>*@
                                        <th width="15%">Patent Strategy</th>
                                       
                                        <th width="13%">Earliest Launch Date </th>
                                        <th width="13%">Earliest Market Entry</th>


                                        <th width="6%" class="text-center">@SharedLocalizer["Action"]</th>
                                    </tr>
                                </thead>
                                <tbody id="parentBody">
                                    @if (Model.pidf_IPD_PatentDetailsEntities != null && Model.pidf_IPD_PatentDetailsEntities.Count() > 0)
                                    {
                                        @*int loopCount = (Model.pidf_IPD_PatentDetailsEntities.Count() == 0) ? Model.pidf_IPD_PatentDetailsCountries.Count() : Model.pidf_IPD_PatentDetailsEntities.Count();*@
                                        for (int i = 0; i < Model.pidf_IPD_PatentDetailsEntities.Count(); i++)
                                        {
                                            <tr id="parentRow_@i">
                                                @*  <td style="display:none;">
                                        <div class="">
                                        <div class="form-group required">
                                        @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].PatentNumber, new { htmlAttributes = new { @autocomplete = "off",@readonly = true, @class = "form-control checkbox-checked", id = "pidf_IPD_PatentDetailsEntities[" + i + "].PatentNumber", @placeholder = @MasterLocalizer["Patent Number"]} })
                                        </div>
                                        </div>
                                        </td>*@
                                               
                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">
                                                            @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].PatentNumber, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked validateChildDetails",  @placeholder = @MasterLocalizer["PatentNumber"],@required="required" } })
                                                            @*@Html.ValidationMessageFor(model => model.pidf_IPD_PatentDetailsEntities[i].PatentNumber, "", new { @class = "text-danger" })*@
                                                        </div>
                                                        @Html.HiddenFor(model=>model.pidf_IPD_PatentDetailsEntities[i].PatentType)
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">

                                                            @Html.DropDownListFor(model => model.pidf_IPD_PatentDetailsEntities[i].Type, new List<SelectListItem> { new SelectListItem() { Text = "Product", Value = "Product" }, new SelectListItem() { Text = "Formulation", Value = "Formulation" }, new SelectListItem() { Text = "MOU", Value = "MOU" }
                                                    }, htmlAttributes: new { @class = "form-control ", id = "pidf_IPD_PatentDetailsEntitiesAPI[" + i + "].Type"})
                                                          @*@Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].Type, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked validateChildDetails", id = "pidf_IPD_PatentDetailsEntities[" + i + "].Type", @placeholder = @MasterLocalizer["Type"],@required="required" } })*@
                                                            @*@Html.ValidationMessageFor(model => model.pidf_IPD_PatentDetailsEntities[i].Type, "", new { @class = "text-danger", id = "pidf_IPD_PatentDetailsEntities[" + i + "].ValidationType" })*@
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">
                                                            @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].OriginalExpiryDate, new { htmlAttributes = new { @min=@dateRange, @autocomplete = "off", @class = "form-control checkbox-checked originalDate validateChildDetails", id = "pidf_IPD_PatentDetailsEntities[" + i + "].OriginalExpiryDate", @placeholder = @MasterLocalizer["Original Expiry Date"],@required="required" } })
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">
                                                            @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].ExtensionExpiryDate, new { htmlAttributes = new { @min=@dateRange, @autocomplete = "off", @class = "form-control checkbox-checked extendedDate validateChildDetails", id = "pidf_IPD_PatentDetailsEntities[" + i + "].ExtensionExpiryDate", @placeholder = @MasterLocalizer["Extension Expiry Date"],@required="required" } })

                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">
                                                            @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].Comments, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control checkbox-checked validateChildDetails", id = "pidf_IPD_PatentDetailsEntities[" + i + "].Comments", @placeholder = @MasterLocalizer["Comments (Patent Specific)"],@required="required" } })
                                                        </div>
                                                    </div>
                                                </td>
                                               

                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">
                                                            @* <select id="IDSelectPatentStrategyPD" class="form-control SelectPatentStrategyPD"></select>*@
                                                           @* @Html.DropDownListFor(model => model.pidf_IPD_PatentDetailsEntities[i].PatentStrategy, new List<SelectListItem> { }, htmlAttributes: new { @class = "form-control SelectPatentStrategyPD SelectPatentStrategyCommon", id = "pidf_IPD_PatentDetailsEntities[" + i + "].PatentStrategy"})*@
                                                            <input type="hidden" id="hdnPatentFormulationPatentStrategy" value="@Model.pidf_IPD_PatentDetailsEntities[i].PatentStrategy" />
                                                            @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].PatentStrategyOther, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control PatentStrategyOtherPD",id = "pidf_IPD_PatentDetailsEntities[" + i + "].PatentStrategyOther"}})
                                                        </div>
                                                    </div>
                                                </td>
                                               
                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">
                                                            @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].EarliestLaunchDate, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control",id = "pidf_IPD_PatentDetailsEntities[" + i + "].EarliestLaunchDate"}})
                                                        </div>
                                                    </div>
                                                </td>
                                             
                                                <td>
                                                    <div class="">
                                                        <div class="form-group required">
                                                            @Html.EditorFor(model => model.pidf_IPD_PatentDetailsEntities[i].EarliestMarketEntry, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control",id = "pidf_IPD_PatentDetailsEntities[" + i + "].EarliestMarketEntry"}})
                                                        </div>
                                                    </div>
                                                </td>
                                          
                                                <td>
                                                    <div class="col-md">
                                                        <div class="form-group">

                                                            <i class="fa-solid fa-circle-plus nav-icon text-success operationButton" id="addIcon_@i" onclick="addRowParent(@i)"></i>

                                                            <span><i class="fa-solid fa-trash nav-icon text-red apiDeleteIcon operationButton" id="deleteIcon_@i" onclick="removeRowParent(@i, this)"></i></span>
                                                            @Html.HiddenFor(model => model.pidf_IPD_PatentDetailsEntities[i].PatentDetailsID, new { id = "pidf_IPD_PatentDetailsEntities[" + i + "].PatentDetailsID"})
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>

            @*  -------------------Patent API--------------------------*@
          
            @*  ----------------------------------------------*@
        </div>
    </div>

    <div class="row">
        <div class="col-12 text-end">
            <div class="form-group">
                <button type="submit" class="btn btn-success me-3 outside-buttons operationButton" onClick="return SaveIPDClick('Sv');">@SharedLocalizer["Submit"]</button>
                @if (Model.StatusId == (Int32)Master_PIDFStatus.IPDInProgress || Model.StatusId == (Int32)Master_PIDFStatus.PIDFApproved || Model.StatusId == (Int32)Master_PIDFStatus.MedicalSubmitted)
                {
                    <button type="submit" id="btnIPDSaveAsDraft" class="btn btn-primary me-3 outside-buttons operationButton" onClick="return SaveIPDClick('Drf');">@SharedLocalizer["SaveDraft"]</button>
                }
            </div>
        </div>
    </div>
</form>
@*@Html.Partial("_ValidationScriptsPartial")*@
@Html.Partial("_ValidationScriptsPartial")
<script type="text/javascript" src="~/js/Custom/SelectAllAdaptor.js?v=@jsVersion"></script>
<script>
    $(document).ready(function () {
        setRegion();
        IPDSetChildRowDeleteIcon();
        $('.regionCombo').select2({ dropdownAdapter: $.fn.select2.amd.require('select2/selectAllAdapter') });
        $('.countryCombo').select2({ dropdownAdapter: $.fn.select2.amd.require('select2/selectAllAdapter') });
        if (_IPDMode == 1) {
            readOnlyIPDForm();
        }
        if (_IsIPDSubmitted.toLowerCase() === 'true') {
            $('#btnIPDSaveAsDraft').hide();
        }
    });
</script>