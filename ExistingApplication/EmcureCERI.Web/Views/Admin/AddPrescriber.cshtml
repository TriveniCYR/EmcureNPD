@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> SharedLocalizer
@model EmcureCERI.Web.Models.AdminViewModels.PrescriberViewModel
@{
    ViewData["Title"] = @SharedLocalizer["Add Prescriber"].Value;
}

<ul class="nav nav-tabs">
    <li class="active"><a asp-area="" asp-controller="Admin" asp-action="AllRequestedPrescriber">@SharedLocalizer["New Requested"].Value</a></li>
    <li><a asp-area="" asp-controller="Admin" asp-action="AllApprovedPrescriber">@SharedLocalizer["Approved"].Value</a></li>
    <li><a asp-area="" asp-controller="Admin" asp-action="AllDeactivatedPrescriber">@SharedLocalizer["Declined"].Value</a></li>
    <li><a asp-area="" asp-controller="Admin" asp-action="AllRejectedPrescriber">@SharedLocalizer["Rejected"].Value</a></li>
</ul>

<div class="tableContainer clearfix">
    <div class="table-responsive">
        <table id="AddPrescriberTableId" class="table stripe row-border order-column" style="width:100%">
            <thead>
                <tr>
                    <th>@SharedLocalizer["First Name"].Value</th>
                    <th>@SharedLocalizer["Last Name"].Value</th>
                    <th>@SharedLocalizer["Email"].Value</th>
                    <th>@SharedLocalizer["Contact No"].Value</th>
                    <th style="min-width: 90px;">@SharedLocalizer["Action"].Value</th>
                </tr>
            </thead>
        </table>
    </div>
    <div class="text-right addRecordBtnContainer">
        <a class="btn btn-primary" onclick="PopupForm('@Url.Action("PrescriberAddOrEdit","Admin")');"><i class="fa fa-plus"></i> @SharedLocalizer["Add Prescriber"].Value</a>
    </div>
</div>

<div id="prescriberViewModal" class="modal themeModal " role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@SharedLocalizer["View Prescriber Details"].Value</h4>
            </div>
            <div class="modal-body">
                <p>@SharedLocalizer["Some text in the modal."].Value</p>
             </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var Popup, dataTable;
        $(document).ready(function () {
            dataTable = $("#AddPrescriberTableId").DataTable({
                "ajax": {
                    "url": "/Admin/GetPrescriber",
                    "type": "GET",
                    "datatype": "json/application"
                },
                "columns": [
                    { "data": "FirstName" },
                    { "data": "LastName" },
                    { "data": "Email" },
                    { "data": "ContactNo" },
                    {
                        "data": "Id" , "render": function (data) {
                            return "<a title='@SharedLocalizer["Edit"].Value' class='btn btn-info btn-sm custTblBtn' onclick=PopupForm('@Url.Action("PrescriberAddOrEdit", "Admin")/" + data + "')><span class='glyphicon glyphicon-pencil' aria-hidden='true'></span> </a>  <a title='@SharedLocalizer["Deleted"].Value' class='btn btn-primary btn-sm custTblBtn' onclick=Delete(" + data + ") > <span class='glyphicon glyphicon-trash' aria-hidden='true'></span></a >";
                    },
                        "orderable": false,
                        "searchable":false,
                        "width": "150px",
                        "className": "text-center"
					}

                ],
                language: {
                    "emptyTable": "@SharedLocalizer["No data available in table"].Value",
                    "info": "@SharedLocalizer["Showing _START_ to _END_ of _TOTAL_ entries"].Value",
                    "infoEmpty":"@SharedLocalizer["Showing 0 to 0 of 0 entries"].Value",
                    "infoFiltered":"@SharedLocalizer["(filtered from _MAX_ total entries)"].Value",
                    "lengthMenu":"@SharedLocalizer["Show _MENU_ entries"].Value",
                    "loadingRecords": "@SharedLocalizer["Loading..."].Value",
                    "processing": "@SharedLocalizer["Processing..."].Value",
                    "search": "@SharedLocalizer["Search"].Value",
                    "zeroRecords":"@SharedLocalizer["No matching records found"].Value",
                    "paginate": {
                        "first":"@SharedLocalizer["First"].Value",
                        "last":"@SharedLocalizer["Last"].Value",
                        "next": "@SharedLocalizer["Next"].Value",
                        "previous":"@SharedLocalizer["Previous"].Value"
                    },
                },
                //"language": {
                //    "emptyTable" : "No data found, Please click on <b>Add New</b> Button"
                //},
                "scrollY": "70vh",
                "scrollX": true,
                "scrollCollapse": true,
                "paging": false
            });
        });

        function PopupForm(url) {
            $.get(url)
                .done(function (response) {
                    $('#prescriberViewModal .modal-title').html('@SharedLocalizer["Add Prescriber"].Value');
                    $('#prescriberViewModal .modal-body').html(response);
                    $('#prescriberViewModal').modal('show');
                });
        }

        function SubmitForm(form) {
            $.validator.unobtrusive.parse(form);
            if ($(form).valid()) {
                $.ajax({
                    type : "POST",
                    url : form.action,
                    data : $(form).serialize(),
                    success: function (data) {
						if (data.success === "success") {
                            $('#prescriberViewModal').modal('hide');
                            dataTable.ajax.reload();
                            openCommonModal('successModal modal-sm', '@Html.Raw(SharedLocalizer["Success"].Value)', '@Html.Raw(SharedLocalizer["Record has been added successfully."].Value)', false);
						} else {
                            if (data.success === "error") {
                                $('#prescriberViewModal').modal('hide');
                                    openCommonModal('alertModal modal-sm', '@SharedLocalizer["Error"].Value', data.message.Description, false);
								}
						}
                    }
                });
            }
            return false;
        }

        function Delete(id) {
            openCommonModal('confirmModal modal-sm', '@SharedLocalizer["Are you sure?"].Value', '@SharedLocalizer["Once you delete, it can not be retrieved."].Value', true).done(function (isConfirm) {
                if (isConfirm) {
                    $('#commonModal').modal('hide');
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("PrescriberDelete", "Admin")/' + id,
                        success: function (data) {
                            if (data.success) {
                                dataTable.ajax.reload();
                                openCommonModal('successModal modal-sm', '@Html.Raw(SharedLocalizer["Success"].Value)', '@SharedLocalizer["Record has been deleted successfully."].Value', false);
                            }
                        }
                    });
                }
            });
        }
    </script>
}
